mode_211
enable_trace
establish_context
card_connect -readerNumber 1
select -AID 627601FF000000

// open secure channel with encryption and mac
open_sc -security 3 -scp 2 -scpimpl 21 -keyind 0 -keyver 0 -key 404142434445464748494a4b4c4d4e4f -keyDerivation emvcps11

// CKYCreateObject
send_apdu -sc 1 -APDU 845a00000eff00fff3000004cc400040004000

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000d9ff00fff300000000d001090800dfc50346b46a3c145e10ddf95beb173b47157fefcd8abe24b98cc29b25aa30dfbf8e95546f0a70fcb9139d288fda4eca6ba1ddd7297fcba8f717a2f90d126437033a6a84c5d6e289b3c02dd0f00f5cf7d517d7a0a56a60853c96ccbc60e2e0f897421fe055b2c0686c5f35d0adbbf25ef0c6a9bc46b8051c595acf2a724c8852379490bf3def6dfa6d631411457fb50c70a592818aea534443193aeb5aba8d0a30e76dc2384a171f972be94cafe67f594e6ea40d3f9fc81681a7ad584f28adcccf55547b640b2f3bca0292b2

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000d9ff00fff3000000d0d0b4f06b5d40498633a5cead11ef50de1e4ceccfb4c9df9a17a896a4a60b5d3d0f80e5ca6b023edce1742265ec77fdb87e7006c500665a7d4cdb5b00d5c053baa04070578af0ea8ce92f425065cc206402cb2c757b4bdde66bbc377e1d5675183b5a446e106327767dbc5db08531c2b6d90b84d90d62d0e8d7fce854a22353da6e3181bb52dd9cb75cdc085c82d86d8fb897d626a62f0e9793c98d4b439904b5652a09a141b77c2fe7ee8c6f0d723b472f580412571c25b8748e704dcbdd513de5008a1e864b5110cba41d260796f822c6

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000d9ff00fff3000001a0d0ee36917f3ecccc95f70245024191a6c41156615621dbbe501adc510c416409a97df68b2fb41eac9e7e5c74928e7dc324e63fd3a7f1e76c48bc1752d6e5a635ec1200dd4c7d70c94a05b7076f41e4431e5cc34b26fbf26e797252c718161db3fc901c1d7261c8c8e14f7f7b318968526b7e96212dc089031f1e8f22d5edbc2b578ff109e99ab7203ff3600df5897f9d6ffa3fd3416db9fe3f574fa9c37762da5bb939f89133305f722a6f580a91d8d4cb17196527fc2695e1b11e022957a8eabc0221144433dbf0b0f521f3b1e19a46bd

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000d9ff00fff300000270d0ee53a96a1235e138db5d1775c39c593f606d691f5d992f6b78e9b25948ac142ca5024a1e30886758f82c7cb1985106ee9956eeeb6aabff8f69339f71e1526c0ef56d76c2289932999735ba4117779c55756203110bd1aa1bfdc473a545b268ffede9de9038503b4462d17024ef18a812d4cfd95afdef1ba4f42cd5852556afbb942e7fff3d8a52be85a881bd6388f41441ee32f0f68e85b6f5f3052f9437506d443852e9f01801939e9649790166c1ceda0f3a59f7bfc438c8f67b2ee372a45900f5b95eb892ff67b55f3f95e0291d4f

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000d9ff00fff300000340d00c399507c6b998cdd627e9fed4df79b1ddec66f423b016b2fa85062c3527f177dae6e42a4f416cf904d0580358688de57b7276c21cddfaf261b5f0ec8824558ba1e591b234ddf3f601470b5042247cb62e021f67b50ea1950ac0b829e454f95e9326bb3d8e52629b733e39d33c9260df892d1118126c41d1fe25c4651f9e31cb4af0f54d41bfce0f6395c0d2a0bea5424696b3b032d6e98ea8914aaadcaeebab4b798c6dd3c75e0ef79a659ac1095d469bc0315136e261cd19f33c867d1f23eb9fab9d951b287a4fba97e0ee61725115

// CKYWriteObject
send_apdu -sc 1 -APDU 84540000c5ff00fff300000410bc6126cf7f0e05822a82de27856c2525bf6d9430c2350a2753b1a4dffecf1292e19629ceee9c22a0105020b72ce0cbd49cdedc3a2d7e9472c88b3377153588ba27f9fa589ce249331fe4feceab6909cad7fec4ca56c08a717f0ef354e5769d65fc61ad0841015fe8c898fe78c140bbe0b33b13c34a43cd09c7c1a163fd31f71760ae75d2a6c129aeadb7bb8fc59a96cc69761b97659c6e721751e084126835dc6e14ed35f2b055d48335a1cd49cd74aa4086e741e83a642f965763c6d7

// unencrypted wrapping key
set -result_var unencryptedWrapKey -data 927507082a5e6b0d02a1e976020e7a92
// encrypt wrapping key with session DEK
set -result_var encryptedWrapKey -cipher des2 -cipherdirection encrypt -cipherchainmode ecb -sessionkey dek -data %unencryptedWrapKey%

// CKYImportKeyEncrypted - use SDEK-encrypted wrapping key
send_apdu -sc 1 -APDU 840a040523ff00fff38110%encryptedWrapKey%0399dcea0817c79ca41d027735

card_disconnect
release_context
